{{- if .Values.rateLimit.enabled }}
---
# Rate limit middleware for backend API
apiVersion: traefik.io/v1alpha1
kind: Middleware
metadata:
  name: {{ include "resume.fullname" . }}-backend-ratelimit
  namespace: {{ .Release.Namespace }}
  labels:
    {{- include "resume.labels" . | nindent 4 }}
spec:
  rateLimit:
    average: {{ .Values.rateLimit.backend.average }}
    burst: {{ .Values.rateLimit.backend.burst }}
    period: {{ .Values.rateLimit.backend.period }}
---
# Rate limit middleware for frontend
apiVersion: traefik.io/v1alpha1
kind: Middleware
metadata:
  name: {{ include "resume.fullname" . }}-frontend-ratelimit
  namespace: {{ .Release.Namespace }}
  labels:
    {{- include "resume.labels" . | nindent 4 }}
spec:
  rateLimit:
    average: {{ .Values.rateLimit.frontend.average }}
    burst: {{ .Values.rateLimit.frontend.burst }}
    period: {{ .Values.rateLimit.frontend.period }}
{{- end }}
---
# HTTP to HTTPS redirect middleware
apiVersion: traefik.io/v1alpha1
kind: Middleware
metadata:
  name: {{ include "resume.fullname" . }}-redirect-https
  namespace: {{ .Release.Namespace }}
  labels:
    {{- include "resume.labels" . | nindent 4 }}
spec:
  redirectScheme:
    scheme: https
    permanent: true
